<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Natijalar</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body >
<section class="full-height bg-muted">
    <header class="page bg-white">
        <span class="go-back" onclick="window.location.href='aviabiletlar.html'">
            <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.5 7L10.5 14L17.5 21" stroke="#8D8D8D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </span>
        <h2><span class="head"> Samarqand <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4.16663 10H15.8333" stroke="#1A1A1A" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12.5 13.3333L15.8333 10" stroke="#1A1A1A" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12.5 6.66663L15.8333 9.99996" stroke="#1A1A1A" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
        </svg> Toshkent </span><span>1 yo‘lovchi, ekonom</span></h2>
        <span>&nbsp;</span>
    </header>
    <nav class="slider-container">
        <div class="slider" style="width: calc( 105px * 10)">
            
        </div>
    </nav>
    <div class="container">
        <!-- <div class="ticket-types">
            <span class="badge active">Arzon</span>
            <span class="badge">Tezkor</span>
            <span class="badge">Arzon</span>
            <span class="badge">Arzon</span>
        </div> -->
        <div class="tickets">
            So'rov bo'yicha chiptalar qidirilmoqda... <br>
            Iltimos kuting...
        </div>
    </div>
    <div class="filter btn btn-primary">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5.49999 5H18.5C18.644 5.05051 18.7745 5.13331 18.8816 5.24206C18.9887 5.35082 19.0695 5.48264 19.1177 5.62742C19.166 5.77221 19.1805 5.92612 19.1601 6.07737C19.1396 6.22861 19.0849 6.37318 19 6.5L14 12V19L9.99999 16V12L4.99999 6.5C4.91508 6.37318 4.86032 6.22861 4.83991 6.07737C4.81951 5.92612 4.83399 5.77221 4.88225 5.62742C4.93051 5.48264 5.01127 5.35082 5.11835 5.24206C5.22542 5.13331 5.35597 5.05051 5.49999 5Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        Filtrlash            
    </div>
    <section class="help-window" id="parvoz">
        <div class="overlay"></div>
        <div class="window-content">
            <div class="window-header">
                <h2>Parvoz tafsilotlari</h2>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6 6L18 18" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="window-inner">
                <div class="ticket-about">
                    <div class="regions">Samarqand - Toshkent</div>
                    <div class="bonus">
                        <span>+22</span>
                        <img src="./img/coin.png" alt="Bonus">
                    </div>
                </div>
                <span class="ticket-date">27-yanvar</span>
                <div class="ticket-content">
                    <div class="airport-info">
                        <img class="airport-logo" src="./img/airport.svg" alt="airport">
                        <div class="air-info">
                            <div class="air-name">Uzbekistan Airways</div>
                            <div class="air-long">4 s, 35 daq</div>
                        </div>
                    </div>
                    <div class="fly-content">
                        <div class="left-img">
                            <svg width="24" height="91" viewBox="0 0 24 91" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12.5" cy="3.5" r="2.5" transform="rotate(90 12.5 3.5)" stroke="#109BFF" stroke-width="2"/>
                                <circle cx="12.5" cy="87.5" r="2.5" transform="rotate(90 12.5 87.5)" stroke="#109BFF" stroke-width="2"/>
                                <line opacity="0.4" x1="12.5" y1="5.5" x2="12.5" y2="84.5" stroke="#109BFF" stroke-linecap="round" stroke-dasharray="2 4"/>
                                <path d="M14.6111 48.7L14.6111 52.9C14.6111 53.457 14.3887 53.9911 13.9928 54.3849C13.5969 54.7787 13.0599 55 12.5 55C11.9401 55 11.4031 54.7787 11.0072 54.3849C10.6113 53.9911 10.3889 53.457 10.3889 52.9L10.3889 48.7L3 44.5L3 41.35L10.3889 43.45L10.3889 39.25L8.27778 37.15L8.27778 34L12.5 36.1L16.7222 34L16.7222 37.15L14.6111 39.25L14.6111 43.45L22 41.35L22 44.5L14.6111 48.7Z" fill="#109BFF"/>
                            </svg>
                        </div>
                        <div class="parvoz">
                            <div class="parvoz-inner">
                                <div class="p-vaqt"><div class="parvoz-time">12:00</div>
                                <div class="parvoz-date">20-yan, Ju</div></div>
                                <div class="p-locations">
                                    <div class="p-region">Samarqand</div>
                                    <div class="p-airport">Sharqona, TAS</div>
                                </div>
                            </div>
                            <div class="parvoz-inner">
                                <div class="p-vaqt"><div class="parvoz-time">12:00</div>
                                <div class="parvoz-date">20-yan, Ju</div></div>
                                <div class="p-locations">
                                    <div class="p-region">Samarqand</div>
                                    <div class="p-airport">Sharqona, TAS</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary btn-block continue">Davom etish</button>
            </div>
        </div>
    </section>
    <section class="help-window" id="filter">
        <div class="overlay"></div>
        <div class="window-content">
            <div class="window-header">
                <h2>Saralash</h2>
                    <a style="font-size: 12px;" href="#">Qayta o'rnatish</a>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6 6L18 18" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="window-inner filter-window">
                <h2>Transplantatsiya</h2>
                <span class="transfer-count">O'tkazmalar soni</span>
                <div class="transfers">
                    <span class="badge">1 dan kam</span>
                    <span class="badge">Barcha reyslar</span>
                </div>
                <h2>Transfer muddati</h2>
                <div class="transfers">
                    <span class="badge">1 dan kam</span>
                    <span class="badge">Barcha reyslar</span>
                    <span class="badge">1 dan kam</span>
                    <span class="badge">Barcha reyslar</span>
                </div>
                <div class="row between" style="margin: 20px 0px;">
                    <h2>Tungi transferlarsiz</h2>
                    <label for="tungi" class="check"> <input type="checkbox" name="tungi" id="tungi"> <span class="switch"></span> </label>
                </div>
                <div class="go-time">
                    <h2>Transfer jo‘nash vaqtlari</h2>
                    <div class="go-inner">
                        <div class="go-info">
                            <h3>Samarqanddan jo'nash vaqti</h3>
                            <span>00:00 - 23:59</span>
                        </div>
                        <div class="go-range">

                        </div>
                        <div class="go-info">
                            <h3>Toshkentga tushish vaqti</h3>
                            <span>00:00 - 23:59</span>
                        </div>
                        <div class="go-range">
                            
                        </div>
                    </div>
                </div>
                <div class="filter-airports" data-target="#avia-companies">
                    <h2>Aviakompaniyalar</h2>
                    <span><svg width="28" height="28" viewBox="0 0 28 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10.5 21L17.5 14L10.5 7" stroke="#A4A4A4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </span>
                </div>
                <button class="btn btn-primary btn-block">5ta bilet topildi</button>
            </div>
        </div>
    </section>
    <section class="help-window filter-check" id="avia-companies">
        <div class="overlay" data-target="#filter"></div>
        <div class="window-content">
            <div class="window-header">
                <h2>Aviakompaniyalar</h2>
                
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-target="#filter">
                    <path d="M18 6L6 18" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6 6L18 18" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="window-inner">
                <div class="search-group">
                    <input type="text" class="form-control" id="search-input" placeholder="Shahar yoki aeroport">
                    <span class="search-icon">
                         <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                             <g opacity="0.5">
                             <path d="M10 17C13.866 17 17 13.866 17 10C17 6.13401 13.866 3 10 3C6.13401 3 3 6.13401 3 10C3 13.866 6.13401 17 10 17Z" stroke="#929292" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                             <path d="M21 21L15 15" stroke="#929292" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                             </g>
                         </svg>
                    </span>
                    <span class="input-clear">
                     <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                         <path opacity="0.2" fill-rule="evenodd" clip-rule="evenodd" d="M16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8ZM11.7303 4.26967C12.0232 4.56256 12.0232 5.03744 11.7303 5.33033L9.06066 8L11.7303 10.6697C12.0232 10.9626 12.0232 11.4374 11.7303 11.7303C11.4374 12.0232 10.9626 12.0232 10.6697 11.7303L8 9.06066L5.33033 11.7303C5.03744 12.0232 4.56256 12.0232 4.26967 11.7303C3.97678 11.4374 3.97678 10.9626 4.26967 10.6697L6.93934 8L4.26967 5.33033C3.97678 5.03744 3.97678 4.56256 4.26967 4.26967C4.56256 3.97678 5.03744 3.97678 5.33033 4.26967L8 6.93934L10.6697 4.26967C10.9626 3.97678 11.4374 3.97678 11.7303 4.26967Z" fill="black"/>
                     </svg>                    
                    </span>
                </div>
                <ul class="results">
                    <li>
                         <label for="UzAir">
                             <div class="air">
                                 <img src="./img/airport.svg" alt="UzAir">
                                 <span>
                                    Uzbekistan Airways
                                 </span>
                             </div>
                             <input type="checkbox" name="UzAir" id="UzAir">
                         </label>
                     </li>
                     <li>
                        <label for="UzAir1">
                            <div class="air">
                                <img src="./img/airport.svg" alt="UzAir">
                                <span>
                                   Uzbekistan Airways
                                </span>
                            </div>
                            <input type="checkbox" name="UzAir1" id="UzAir1">
                        </label>
                    </li>
                    <li>
                        <label for="UzAir2">
                            <div class="air">
                                <img src="./img/airport.svg" alt="UzAir">
                                <span>
                                   Uzbekistan Airways
                                </span>
                            </div>
                            <input type="checkbox" name="UzAir2" id="UzAir2">
                        </label>
                    </li>
                </ul>
            </div>
        </div>
    </section>
    <script src="./request.js"></script>
    <script>
        let allTickets=[];
        // GET LIST OF AIRLINES
        let airlines=[];
        {
            let xhr = new XMLHttpRequest();
            xhr.addEventListener("load", function(event){
                airlines=JSON.parse(event.target.response);
            }, false);
            xhr.open("GET", "./CONST/airlines.json", true);
            xhr.setRequestHeader("Content-Type", "application/json; charset=utf-8");
            xhr.send();
        }
        // GET LIST OF AIRPORTS
        let AIRPORTS=[];
        {
            let xhr1 = new XMLHttpRequest();
            xhr1.addEventListener("load", function(event){
                AIRPORTS=JSON.parse(event.target.response);
            }, false);
            xhr1.open("GET", "./CONST/airports.json", true);
            xhr1.setRequestHeader("Content-Type", "application/json; charset=utf-8");
            xhr1.send();
        }
        // GET SINGLE AIRLINE INFO BY iataCode
        function getAirline(code){
            return airlines.find(function(airline){
                if (airline.code==code){
                    return true;
                }
            })
        }
        // GET SINGLE AIRPORT INFO BY iataCode
        function getAirport(code){
            return AIRPORTS.find(function(airport){
                if (airport.code==code){
                    return true;
                }
            })
        }
        // For show money as MO NEY 000
        function showMoney(money){
            let result=money.toString().split("").reverse().map(function(digit,index){
                return index%3==0?digit+" ":digit;
            }).reverse().join("");
            return result;
        }
        // For show tickets time as HH:MM - HH:MM of ticket
        function showTime(ticket){
            const from_date=new Date(ticket.itineraries[0].segments[0].departure.at);
            const to_date=new Date(ticket.itineraries[0].segments[ticket.itineraries[0].segments.length-1].arrival.at);
            let from_minutes="";
            if (from_date.getMinutes()>9){
                from_minutes=from_date.getMinutes();
            } else {
                from_minutes="0"+from_date.getMinutes();
            }
            let to_minutes="";
            if (to_date.getMinutes()>9){
                to_minutes=to_date.getMinutes();
            } else {
                to_minutes="0"+to_date.getMinutes();
            }
            return from_date.getHours()+":"+from_minutes+" - "+to_date.getHours()+":"+to_minutes;
        }
        function setTodayMin(cost){
            document.querySelector(".slider-item.active .cost").innerText=showMoney(parseInt(cost))+' UZS'; 
        }
        function showAllTimes(ticket){
            let result='';
            const from_date=new Date(ticket.itineraries[0].segments[0].departure.at);
            let from_minutes="";
            if (from_date.getMinutes()>9){
                from_minutes=from_date.getMinutes();
            } else {
                from_minutes="0"+from_date.getMinutes();
            }
            result=from_date.getHours()+":"+from_minutes;
            for(i=0; i<ticket.itineraries[0].segments.length; i++){
                let to_date=new Date(ticket.itineraries[0].segments[i].arrival.at)
                let to_minutes="";
                if (to_date.getMinutes()>9){
                    to_minutes=to_date.getMinutes();
                } else {
                    to_minutes="0"+to_date.getMinutes();
                }
                result+=" - "+to_date.getHours()+":"+to_minutes;
            }
            return result;
        }
        // For show directions of ticket e.g. NYC - LON - TSK
        function showTicketDirs(ticket){
            let result=getAirport(ticket.itineraries[0].segments[0].departure.iataCode).cc;
            for (i=0; i<ticket.itineraries[0].segments.length; i++){
                result+=" - "+getAirport(ticket.itineraries[0].segments[i].arrival.iataCode).cc
            }
            return result;
        }
        // For show time difference from first departure and last arrival
        function showTimeDiff(ticket){
            const dateDiff=new Date(ticket.itineraries[0].segments[ticket.itineraries[0].segments.length-1].arrival.at)-new Date(ticket.itineraries[0].segments[0].departure.at);
            let natija="";
            const kun=parseInt(dateDiff / 86400000);
            const soat=parseInt((dateDiff % 86400000)/3600000);
            const daqiqa=parseInt((dateDiff % 3600000)/60000);
            if (kun>0){
                natija=kun+" k, ";
            }
            natija+=soat+"s, "+daqiqa+" daq";
            return natija
        }
        // For show date as D MMM, DAY[3]
        function formatDateToShow(date){
            const week=[
                "Yak",
                "Dush",
                "Sesh",
                "Chor",
                "Pay",
                "Jum",
                "Shan"
                ]
            const months=[
                "Yan",
                "Fev",
                "Mar",
                "Apr",
                "May",
                "Iyn",
                "Iyl",
                "Avg",
                "Sen",
                "Okt",
                "Noy",
                "Dek"
            ]
            return date.getDate()+" "+months[date.getMonth()]+", "+week[date.getDay()];
        }
        // This function executes if checkToken request will success and receives data as XMLHttpRequest event.
        // If result is not success (on AuthError) redirects to login page.
        function onCheckToken(event){
            console.log(JSON.parse(event.target.response))
            if (JSON.parse(event.target.response).status!=="success"){
                window.location.href="./login.html"
            }
        }
        // Function creates a Ticket's HTML code and appends to <div class='tickets'></div>
        function renderTicket(ticket){
            const from=JSON.parse(localStorage.getItem("air-properties")).from;
            const to=JSON.parse(localStorage.getItem("air-properties")).to;
            const inHTML=`<div class="ticket-result" id="ticket_${ticket.id}">
                <div class="ticket-head">
                    <div class="airport">
                        <img class="airport-logo" src="https://mpics.avs.io/al_square/30/30/${ticket.itineraries[0].segments[0].carrierCode}.png" alt="UzAir">
                        <span class="airport-name">${getAirline(ticket.itineraries[0].segments[0].carrierCode).name}</span>
                    </div>
                    <div class="bonus">
                        <span>+22</span>
                        <img src="./img/coin.png" alt="">
                    </div>
                </div>
                <div class="ticket-info">
                    <div class="destinations">
                        <div class="times">${showTime(ticket)}</div>
                        <div class="locations">${showTicketDirs(ticket)}</div>
                    </div>
                    <div class="fly-about">
                        <div class="fly-time">${showTimeDiff(ticket)}</div>
                        <div class="fly-type">${ticket.itineraries[0].segments.length>1 ? ticket.itineraries[0].segments.length-1+" ta qo'nish": "To'g'ridan to'g'ri"}</div>
                    </div>
                </div>
                <div class="pricing">
                    <button class="btn btn-primary">${showMoney(parseInt(ticket.price.total))} ${ticket.price.currency}</button>
                    <div class="bonus">
                        <img src="./img/coin.png" alt="">
                        <span> 4 850</span>
                    </div>
                </div>
                <div class="i-dont">
                    ${showMoney(parseInt((parseInt(ticket.price.total)+parseInt(ticket.price.total)*0.1)/12))} <span> x12 </span>
                </div>
            </div>`;
            document.querySelector(".tickets").innerHTML+=inHTML;
            document.querySelectorAll(".ticket-result").forEach(function(item){
                item.addEventListener("click", function(){
                    document.querySelector("#parvoz").classList.add("active");
                    const ticketId=item.id.split("_")[1];
                    const selectedTicket=allTickets.flightOffersSearch.find(function(singleTicket){
                        return singleTicket.id==ticketId
                    })
                    // console.log(selectedTicket);
                    const ticketInformation=`<div class="ticket-about">
                    <div class="regions">${showTicketDirs(selectedTicket)}</div>
                    <div class="bonus">
                        <span>+22</span>
                        <img src="./img/coin.png" alt="Bonus">
                    </div>
                </div>
                <span class="ticket-date">${formatDateToShow(new Date(selectedTicket.itineraries[0].segments[0].departure.at))}</span>
                <div class="ticket-content">
                    <div class="airport-info">
                        <img class="airport-logo" src="https://mpics.avs.io/al_square/30/30/${selectedTicket.itineraries[0].segments[0].carrierCode}.png" alt="airport">
                        <div class="air-info">
                            <div class="air-name">${getAirline(selectedTicket.itineraries[0].segments[0].carrierCode).name}</div>
                            <div class="air-long">${showTimeDiff(selectedTicket)}</div>
                        </div>
                    </div>
                    <div class="fly-content">
                        <div class="left-img">
                            <svg width="24" height="91" viewBox="0 0 24 91" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12.5" cy="3.5" r="2.5" transform="rotate(90 12.5 3.5)" stroke="#109BFF" stroke-width="2"/>
                                <circle cx="12.5" cy="87.5" r="2.5" transform="rotate(90 12.5 87.5)" stroke="#109BFF" stroke-width="2"/>
                                <line opacity="0.4" x1="12.5" y1="5.5" x2="12.5" y2="84.5" stroke="#109BFF" stroke-linecap="round" stroke-dasharray="2 4"/>
                                <path d="M14.6111 48.7L14.6111 52.9C14.6111 53.457 14.3887 53.9911 13.9928 54.3849C13.5969 54.7787 13.0599 55 12.5 55C11.9401 55 11.4031 54.7787 11.0072 54.3849C10.6113 53.9911 10.3889 53.457 10.3889 52.9L10.3889 48.7L3 44.5L3 41.35L10.3889 43.45L10.3889 39.25L8.27778 37.15L8.27778 34L12.5 36.1L16.7222 34L16.7222 37.15L14.6111 39.25L14.6111 43.45L22 41.35L22 44.5L14.6111 48.7Z" fill="#109BFF"/>
                            </svg>
                        </div>
                        <div class="parvoz">
                            <div class="parvoz-inner">
                                <div class="p-vaqt"><div class="parvoz-time">${showTime(selectedTicket).split("-")[0]}</div>
                                <div class="parvoz-date">${formatDateToShow(new Date(selectedTicket.itineraries[0].segments[0].departure.at))}</div></div>
                                <div class="p-locations">
                                    <div class="p-region">${showTicketDirs(selectedTicket).split("-")[0]}</div>
                                    <div class="p-airport">${getAirport(selectedTicket.itineraries[0].segments[0].departure.iataCode).n}</div>
                                </div>
                            </div>
                            ${selectedTicket.itineraries[0].segments.map(function(segment, index){ return (
                                `<div class="parvoz-inner">
                                <div class="p-vaqt"><div class="parvoz-time">${showAllTimes(selectedTicket).split("-")[index+1]}</div>
                                <div class="parvoz-date">${formatDateToShow(new Date(selectedTicket.itineraries[0].segments[index].arrival.at))}</div></div>
                                <div class="p-locations">
                                    <div class="p-region">${showTicketDirs(selectedTicket).split("-")[index+1]}</div>
                                    <div class="p-airport">${getAirport(selectedTicket.itineraries[0].segments[index].arrival.iataCode).n}</div>
                                </div>
                            </div>`
                            )})}
                        </div>
                    </div>
                </div>`
                console.log(ticketInformation);
                document.querySelector("#parvoz .window-inner").innerHTML=ticketInformation;
                    item.classList.add("pressed")
                })
            })
        }
        // This function executes if getTickets request will success and receives data as XMLHttpRequest event.
        // Checks the result. When data.length>0 sends each ticket to renderTicket(ticket). else works through error.
        function onTicketsSuccess(event){
            document.querySelector(".tickets").innerHTML="";
            var response=JSON.parse(event.target.response);
            console.log(JSON.parse(event.target.response).data);
            if (response.status=="success"){
                if (response.data.flightOffersSearch.length>0){
                    allTickets=response.data;
                    response.data.flightOffersSearch.forEach(function(item){
                        renderTicket(item);
                    })
                    setTodayMin(allTickets.flightOffersSearch[0].price.total)
                } else {
                    document.querySelector(".tickets").innerHTML="So'rov bo'yicha natijalar topilmadi :("
                    sayError("So'rov bo'yicha natijalar topilmadi :(");
                }
            } else {
                sayError("Xatolik. "+response.message);
            }
        }
        // This function will create <div class='slider-item'></div> and returns sliderItem to renderSlider.
        function createSlider(timeStamp, starts=new Date().getTime()){
            const slider=document.createElement("DIV");
            const date=new Date(timeStamp);
            slider.classList.add("slider-item");
            slider.innerHTML=`<span class="date">${formatDateToShow(date)}</span><span class="cost"> yuklanmoqda... </span>`;
            slider.id="slider_"+timeStamp;
            if (timeStamp==starts){
                slider.classList.add("active");
            }
            return slider;
        }
        // Renders Slider Ribbon <div class="slider" style="width: calc(102px * {sliderItemsCount})"> ... ... ... </div>
        function renderSlider(from, to){
            const count=(to.date-from.date)/86400000;
            const sliderContainer=document.querySelector(".slider");
            sliderContainer.style.width=102*count+"px";
            for(i = 0; i < count; i++){
                const date = new Date(from.date + (i * 86400000));
                const slider=createSlider(date.getTime(), from.date);
                sliderContainer.appendChild(slider);
            }
        }
        // Send request to server for tickets looking to localStorage's {air-properties} Item.
        function getTickets(from, to, passengers){
            const date=new Date(from.date).toISOString().split("T")[0]
            if ( new Date(date)<= new Date()){
                sayError("Tanlangan muddat bo'yicha chipta buyurtma qilib bo'lmaydi!");
                window.location.href='aviabiletlar.html'
                return
            }
            send_req(token+`/amadeus/search?from=${from.location.code}&to=${to.location.code}&date=${date}&adults=${passengers.count.kattalar}&children=${passengers.count.bolalar}&infants=${passengers.count.chaqaloqlar}&class=${passengers.class}`, "GET", JSON.stringify({}), onTicketsSuccess);
        }
        // Basic events, functionalities and some stuff for UX and getting correct values from elements
        window.onload=function(){
            checkToken();
            const from=JSON.parse(localStorage.getItem("air-properties")).from;
            const to=JSON.parse(localStorage.getItem("air-properties")).to;
            if (localStorage.getItem("air-properties")){
                const passengers=JSON.parse(localStorage.getItem("air-properties")).passengers;
                document.querySelector("header h2 span:nth-child(2)").innerHTML=`${parseInt(passengers.count.kattalar)+parseInt(passengers.count.bolalar)+parseInt(passengers.count.chaqaloqlar)} yo'lovchi, ${passengers.class}`;
                document.querySelector("header h2 span:nth-child(1)").innerHTML=`
                    ${from.location.name.split(":")[1]} <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.16663 10H15.8333" stroke="#1A1A1A" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12.5 13.3333L15.8333 10" stroke="#1A1A1A" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12.5 6.66663L15.8333 9.99996" stroke="#1A1A1A" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
                </svg> ${to.location.name.split(":")[1]}
                `
            } else {
                window.location.href='./aviabiletlar.html'
            }
            
            const passengers=JSON.parse(localStorage.getItem("air-properties")).passengers;
            renderSlider(from,to);
            getTickets(from, to, passengers);
            document.querySelectorAll(".slider-item").forEach(function(item){
                item.addEventListener("click", function(event){
                    document.querySelectorAll(".slider-item.active").forEach(function(item_inner){
                        item_inner.classList.remove("active")
                    });
                    item.classList.add("active")
                })
            })
            document.querySelectorAll(".ticket-types .badge").forEach(function(item){
                item.addEventListener("click", function(event){
                    document.querySelectorAll(".ticket-types .badge.active").forEach(function(item_inner){
                        item_inner.classList.remove("active")
                    });
                    item.classList.add("active")
                })
            })
            document.querySelectorAll(".window-header svg").forEach(function(item){
                item.addEventListener("click", function(event){
                    console.log(item.parentElement.parentElement.parentElement);
                    item.parentElement.parentElement.parentElement.classList.remove("active")
                document.querySelector(".pressed").classList.remove("pressed")
            })})
            document.querySelectorAll(".overlay").forEach(function(item){
                item.addEventListener("click", function(){
                    
                    item.parentElement.classList.remove("active");
                })
            })
            document.querySelectorAll(".ticket-result").forEach(function(item){
                item.addEventListener("click", function(){
                    document.querySelector("#parvoz").classList.add("active");
                    item.classList.add("pressed")
                })
            })
            document.querySelectorAll(".help-window .badge").forEach(function(item){
                item.addEventListener("click", function(event){
                    item.parentNode.querySelectorAll(".badge.active").forEach(function(item_inner){
                        item_inner.classList.remove("active")
                    });
                    item.classList.add("active")
                })
            })
            document.querySelector(".filter").addEventListener("click", function(event){
                event.target.classList.add("pressed");
                document.querySelector("#filter").classList.add("active")
            })
            document.querySelector(".filter-airports").addEventListener("click", function(event){
                var target_window=event.target;
                while(!target_window.hasAttribute("data-target")){
                    target_window=target_window.parentElement;
                }
                document.querySelector(target_window.getAttribute("data-target")).classList.add("active");
            })
            document.querySelectorAll("#search-input").forEach(function(item){
                item.addEventListener("keyup", function(event){
                if (event.target.value.length>0){
                    document.querySelector(".active .input-clear").classList.add("show");
                } else {
                    document.querySelector(".show.input-clear").classList.remove("show");
                }
            })
            })
            document.querySelectorAll(".input-clear").forEach(function(item){
                item.addEventListener("click", function(event){
                    document.querySelector(".active #search-input").value="";
                    document.querySelector(".show.input-clear").classList.remove("show");
                    document.querySelector(".active #search-input").focus()
                })
            })
            
        }
    </script>
</body>
</html>